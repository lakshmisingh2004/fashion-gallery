<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Infinite Image Gallery - Real API Fetch</title>
<style>
  /* Mobile first black & white color scheme */
  body {
    margin: 0; padding-top: 60px;
    font-family: Arial, sans-serif;
    background: #fff;
    color: #000;
    overflow-x: hidden;
  }
  .header {
    position: fixed; top: 0; left: 0; width: 100%; height: 50px;
    background: #000; color: #fff;
    display: flex; justify-content: center; align-items: center;
    font-weight: 700;
    z-index: 9999;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
  }
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 10px;
  }
  .image-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
  }
  .image-card {
    border-radius: 10px;
    overflow: hidden;
    border: 1px solid #000;
    cursor: pointer;
    transition: transform 0.2s ease;
    background: #fff;
  }
  .image-card:hover {
    transform: scale(1.03);
  }
  .image-card img {
    width: 100%;
    height: 180px;
    object-fit: cover;
    display: block;
  }
  .image-info {
    padding: 8px 10px;
  }
  .image-title {
    font-weight: 700;
    font-size: 1rem;
    margin: 0 0 5px 0;
  }
  .image-description {
    font-size: 0.9rem;
    color: #333;
    margin: 0;
  }
  .loader {
    width: 40px; height: 40px;
    border: 5px solid #000;
    border-top: 5px solid #fff;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 20px auto;
    display: none;
  }
  .loader.show {
    display: block;
  }
  @keyframes spin {
    to {transform: rotate(360deg);}
  }
  /* Responsive breakpoints */
  @media(min-width: 600px) {
    .image-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }
  @media(min-width: 900px) {
    .image-grid {
      grid-template-columns: repeat(4, 1fr);
    }
    .image-card img {
      height: 220px;
    }
  }
</style>
</head>
<body>

<div class="header" id="timer">Sale ends in --:--:--</div>

<div class="container">
  <div class="image-grid" id="imageGrid"></div>
  <div class="loader" id="loader"></div>
</div>

<script>
  const imageGrid = document.getElementById('imageGrid');
  const loader = document.getElementById('loader');
  const timerEl = document.getElementById('timer');

  let currentPage = 1;
  const perPage = 20;
  const maxImages = 200;
  let totalLoaded = 0;
  let isLoading = false;

  // Persistent timer variables
  const TIMER_DURATION_MS = 2 * 60 * 60 * 1000; // 2 hours
  const TIMER_STORAGE_KEY = 'saleEndTime';
  let countdownInterval;

  // Format seconds to HH:MM:SS
  function formatTime(ms) {
    let totalSeconds = Math.floor(ms / 1000);
    const hours = Math.floor(totalSeconds / 3600);
    totalSeconds %= 3600;
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;
    return `${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
  }

  // Timer update function
  function updateTimer() {
    let endTime = localStorage.getItem(TIMER_STORAGE_KEY);
    if (!endTime) {
      endTime = Date.now() + TIMER_DURATION_MS;
      localStorage.setItem(TIMER_STORAGE_KEY, endTime);
    } else {
      endTime = parseInt(endTime, 10);
    }
    const diff = endTime - Date.now();
    if (diff <= 0) {
      timerEl.textContent = "Sale has ended!";
      localStorage.removeItem(TIMER_STORAGE_KEY);
      clearInterval(countdownInterval);
      return;
    }
    timerEl.textContent = `Sale ends in ${formatTime(diff)}`;
  }

  // Create image card element
  function createImageCard(image) {
    const card = document.createElement('div');
    card.className = 'image-card';

    const img = document.createElement('img');
    img.src = image.download_url;
    img.alt = image.author;
    img.loading = 'lazy';

    const info = document.createElement('div');
    info.className = 'image-info';

    const title = document.createElement('h3');
    title.className = 'image-title';
    title.textContent = `Photo by ${image.author}`;

    const desc = document.createElement('p');
    desc.className = 'image-description';
    desc.textContent = `ID: ${image.id}`;

    info.appendChild(title);
    info.appendChild(desc);

    card.appendChild(img);
    card.appendChild(info);

    return card;
  }

  // Fetch images from picsum.photos
  async function fetchImages(page, limit) {
    try {
      isLoading = true;
      loader.classList.add('show');
      const response = await fetch(`https://picsum.photos/v2/list?page=${page}&limit=${limit}`);
      if (!response.ok) throw new Error('Network response was not ok');
      const data = await response.json();
      return data;
    } catch (error) {
      console.error('Error fetching images:', error);
      return [];
    } finally {
      isLoading = false;
      loader.classList.remove('show');
    }
  }

  async function loadNextBatch() {
    if (isLoading) return;
    if (totalLoaded >= maxImages) return;

    const images = await fetchImages(currentPage, perPage);
    if (images.length === 0) return; // no more images

    images.forEach(img => {
      const card = createImageCard(img);
      imageGrid.appendChild(card);
    });
    totalLoaded += images.length;
    currentPage++;
  }

  // Infinite scroll logic
  window.addEventListener('scroll', () => {
    if (isLoading) return;
    const scrollTop = window.scrollY;
    const viewportHeight = window.innerHeight;
    const fullHeight = document.body.offsetHeight;

    if (scrollTop + viewportHeight > fullHeight - 150) {
      loadNextBatch();
    }
  });

  // Init
  window.onload = () => {
    updateTimer();
    countdownInterval = setInterval(updateTimer, 1000);
    loadNextBatch();
  };
</script>

</body>
</html>
